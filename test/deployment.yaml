apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  selector:
    matchLabels:
      app: myapp
  replicas: 2
  template:
    metadata:
      annotations:
        alpha.image.policy.openshift.io/resolve-names: '*'
      labels:
        app: myapp
    spec:
      containers:
        - name: test-openshift-code
          image: image-registry.openshift-image-registry.svc:5000/myapp/test-openshift-code:latest
          imagePullPolicy: Always
          ports:
          - containerPort: 8081
          env:
          - name: MESSAGE
            value: "Hello! How you doin'?"
          - name: MY_NODE_NAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: MY_POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: MY_POD_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: MY_POD_IP
            valueFrom:
              fieldRef:
                fieldPath: status.podIP
          - name: MY_POD_SERVICE_ACCOUNT
            valueFrom:
              fieldRef:
                fieldPath: spec.serviceAccountName
          volumeMounts:
            - name: volume-cm
              mountPath: "/pod-data"
      volumes:
        - name: volume-cm
          configMap:
            name: cm-pod-data
